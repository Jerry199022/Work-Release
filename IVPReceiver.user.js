// ==UserScript==
// @name         通用接收器
// @namespace    Universal Receiver
// @version      V14
// @description  同時支持 IVP 內部系統與 UPS 官網的自動查詢接收器。後臺保活功能。
// @author       Jerry Law
// @match        https://ivp.inside.ups.com/internal-visibility-portal*
// @match        https://www.ups.com/track*
// @grant        none
// @run-at       document-idle
// @updateURL    https://raw.githubusercontent.com/Jerry199022/Work/refs/heads/main/IVPReceiver.js
// @downloadURL  https://raw.githubusercontent.com/Jerry199022/Work/refs/heads/main/IVPReceiver.js
// ==/UserScript==

(function(_0xc1ad91,_0x46af6b){const _0x2759ba={_0x2c5950:0x84,_0x1d41ba:0x9b,_0x1cb6ad:0x85,_0x1b8801:0x9c,_0x1f385c:0xaa},_0x4391c9=_0x506d,_0x4ca850=_0xc1ad91();while(!![]){try{const _0x84a329=parseInt(_0x4391c9(0x77))/0x1+parseInt(_0x4391c9(_0x2759ba._0x2c5950))/0x2+-parseInt(_0x4391c9(0xad))/0x3*(parseInt(_0x4391c9(_0x2759ba._0x1d41ba))/0x4)+-parseInt(_0x4391c9(0x8b))/0x5*(-parseInt(_0x4391c9(_0x2759ba._0x1cb6ad))/0x6)+-parseInt(_0x4391c9(_0x2759ba._0x1b8801))/0x7*(parseInt(_0x4391c9(_0x2759ba._0x1f385c))/0x8)+-parseInt(_0x4391c9(0x80))/0x9+parseInt(_0x4391c9(0xa7))/0xa;if(_0x84a329===_0x46af6b)break;else _0x4ca850['push'](_0x4ca850['shift']());}catch(_0x106337){_0x4ca850['push'](_0x4ca850['shift']());}}}(_0x52e2,0xe9c89),(function(){'use strict';const _0x378bf1={_0x1793ea:0x8a,_0x3c4da8:0x83,_0x20a85c:0x9e},_0x5bc689={_0x36e23a:0xa8,_0x31966c:0xa3,_0xf5a34b:0x7b,_0x206d25:0x82,_0x4527f4:0x8d,_0x131c97:0x88},_0x392bfa={_0x3fc645:0x78,_0x22b914:0x87,_0x20d989:0x91,_0x513019:0xaf,_0x4e3e31:0xa6},_0x4dcb6f={_0x2a4686:0xb0,_0x1380de:0x8d,_0x210dda:0x7c,_0x1f7f13:0x9f,_0x875fa0:0x95,_0x29ca2d:0x8f,_0x4679fe:0x93,_0x292dc5:0xa4,_0x40cf78:0x8c},_0x102fd6={_0x654363:0x89,_0x576ff9:0x98},_0x3bcccb={_0xa94452:0x97,_0x2f4b2d:0x96,_0x922aa6:0xb6,_0x4e6eb9:0x8d,_0xf1f7d3:0x7d},_0x24a9b3=_0x506d;const _0x51cbfd=window[_0x24a9b3(0xb5)][_0x24a9b3(0xa9)],_0x38935e=_0x51cbfd[_0x24a9b3(0x8a)](_0x24a9b3(0x7a)),_0x38518a=_0x51cbfd[_0x24a9b3(_0x378bf1._0x1793ea)]('ups.com'),_0x2d169e='https://upsdrive.lightning.force.com';console[_0x24a9b3(0x8d)](_0x24a9b3(_0x378bf1._0x3c4da8)+_0x51cbfd),console['log']('[Mode]\x20'+(_0x38935e?_0x24a9b3(0x90):_0x38518a?_0x24a9b3(_0x378bf1._0x20a85c):'Unknown\x20Mode'));let _0x2813a8=0x0;const _0x1e39a6=_0x2973db=>new Promise(_0x476a44=>setTimeout(_0x476a44,_0x2973db));function _0x137bab(_0xbe222,_0x36eba3=document[_0x24a9b3(0x9f)],_0x1d9846=0x1388){const _0x24077c={_0x4736e0:0x7e},_0xe91df6={_0x87de70:0x99};return new Promise((_0x131832,_0x577bc6)=>{const _0x373520=_0x506d,_0x85d5b=_0x36eba3[_0x373520(0x78)](_0xbe222);if(_0x85d5b)return _0x131832(_0x85d5b);const _0x3bf085=new MutationObserver(()=>{const _0x4f3d14=_0x373520,_0x36e9d9=_0x36eba3['querySelector'](_0xbe222);_0x36e9d9&&(_0x3bf085[_0x4f3d14(0x94)](),_0x131832(_0x36e9d9));});_0x3bf085[_0x373520(_0x24077c._0x4736e0)](_0x36eba3,{'childList':!![],'subtree':!![]}),setTimeout(()=>{const _0x84bc4c=_0x373520;_0x3bf085[_0x84bc4c(0x94)](),_0x577bc6(new Error('等待元素\x20\x22'+_0xbe222+_0x84bc4c(_0xe91df6._0x87de70)));},_0x1d9846);});}function _0xab2bc4(){const _0x16eb18=_0x24a9b3;try{const _0x3ade41=new Blob([_0x16eb18(_0x3bcccb._0xa94452)],{'type':_0x16eb18(_0x3bcccb._0x2f4b2d)}),_0x42939c=new Worker(URL[_0x16eb18(_0x3bcccb._0x922aa6)](_0x3ade41));_0x42939c[_0x16eb18(0x7f)]=()=>{},console[_0x16eb18(_0x3bcccb._0x4e6eb9)]('[KeepAlive]\x20保活機制已啟動\x20-\x20頻率:\x201分鐘/次');}catch(_0x383180){console[_0x16eb18(_0x3bcccb._0xf1f7d3)](_0x16eb18(0xac),_0x383180);}}function _0x5d1144(_0x22da07){const _0x27fc39=_0x24a9b3;if(!_0x22da07)return![];let _0x215706=null,_0x42c552='';if(_0x38935e)_0x215706=document['querySelector']('h6.h6tracking\x20span');else _0x38518a&&(_0x215706=document[_0x27fc39(0x7c)](_0x27fc39(0xb3)));if(_0x215706){_0x42c552=_0x215706[_0x27fc39(_0x102fd6._0x654363)][_0x27fc39(0xae)]();const _0x491bdd=_0x42c552['replace'](/\s/g,''),_0x2db303=_0x22da07['replace'](/\s/g,'');if(_0x491bdd[_0x27fc39(_0x102fd6._0x576ff9)]()===_0x2db303[_0x27fc39(_0x102fd6._0x576ff9)]())return!![];}return![];}async function _0x407217(_0x5b9d99){const _0x301a81=_0x24a9b3;console[_0x301a81(0x8d)]('[UPS\x20Web]\x20執行查詢:\x20'+_0x5b9d99);const _0x3b55ec=[{'name':_0x301a81(0x92),'inputId':_0x301a81(0x9d),'btnId':_0x301a81(0xb7)},{'name':_0x301a81(_0x4dcb6f._0x2a4686),'inputId':_0x301a81(0xb3),'btnId':_0x301a81(0xa2)}];try{const _0x1a8e5a=document[_0x301a81(0x78)]('button.close[data-dismiss=\x22modal\x22]');_0x1a8e5a&&(console[_0x301a81(_0x4dcb6f._0x1380de)]('[UPS\x20Web]\x20檢測到彈窗關閉按鈕，正在點擊...'),_0x1a8e5a[_0x301a81(0xa6)](),await _0x1e39a6(0x12c));let _0x4cd5ca=document[_0x301a81(_0x4dcb6f._0x210dda)](_0x3b55ec[0x0][_0x301a81(0xa5)])||document['getElementById'](_0x3b55ec[0x1][_0x301a81(0xa5)]);if(!_0x4cd5ca)try{const _0xfc56b0='#'+_0x3b55ec[0x0]['inputId']+_0x301a81(0x8e)+_0x3b55ec[0x1][_0x301a81(0xa5)];_0x4cd5ca=await _0x137bab(_0xfc56b0,document[_0x301a81(_0x4dcb6f._0x1f7f13)],0xbb8);}catch(_0x23700a){console['error'](_0x301a81(0x79));return;}const _0x445ccf=_0x3b55ec['find'](_0x20a042=>_0x20a042[_0x301a81(0xa5)]===_0x4cd5ca['id']);if(!_0x445ccf)return;_0x4cd5ca[_0x301a81(_0x4dcb6f._0x875fa0)](),_0x4cd5ca[_0x301a81(0xb4)]='',_0x4cd5ca[_0x301a81(0xb4)]=_0x5b9d99,_0x4cd5ca[_0x301a81(0x93)](new Event(_0x301a81(_0x4dcb6f._0x29ca2d),{'bubbles':!![]})),_0x4cd5ca[_0x301a81(0x93)](new Event('change',{'bubbles':!![]})),_0x4cd5ca[_0x301a81(_0x4dcb6f._0x4679fe)](new Event(_0x301a81(_0x4dcb6f._0x292dc5),{'bubbles':!![]})),await _0x1e39a6(0xc8);let _0x5bca89=document['getElementById'](_0x445ccf['btnId']);if(!_0x5bca89)try{_0x5bca89=await _0x137bab('#'+_0x445ccf[_0x301a81(0xb2)],document['body'],0x7d0);}catch(_0x2f58e0){}if(_0x5bca89){_0x5bca89[_0x301a81(0xa6)]();try{const _0x2dcb5e=await _0x137bab('#st_App_View_Details',document[_0x301a81(0x9f)],0x2710);_0x2dcb5e&&(await _0x1e39a6(0x64),_0x2dcb5e[_0x301a81(0xa6)]());}catch(_0x45ac7a){}}}catch(_0x1f4003){console[_0x301a81(0x7d)](_0x301a81(_0x4dcb6f._0x40cf78),_0x1f4003);}}async function _0x3508f1(_0x332c2e){const _0x50bd1a=_0x24a9b3;console[_0x50bd1a(0x8d)](_0x50bd1a(0x81)+_0x332c2e);const _0x8f919d=document[_0x50bd1a(0xa0)](_0x50bd1a(0xb1));for(const _0x2003f8 of _0x8f919d){_0x2003f8['click'](),await _0x1e39a6(0x64);}try{const _0x41b45f=document[_0x50bd1a(_0x392bfa._0x3fc645)](_0x50bd1a(_0x392bfa._0x22b914));if(_0x41b45f){const _0x1fb5a7=document[_0x50bd1a(0x78)]('#toggle-visibility\x20>\x20button');if(_0x1fb5a7)_0x1fb5a7['click']();await _0x1e39a6(0xc8);}const _0x28c636=document['querySelector'](_0x50bd1a(_0x392bfa._0x20d989));_0x28c636&&(_0x28c636['click'](),await _0x1e39a6(0xc8));const _0x3d5958=await _0x137bab(_0x50bd1a(_0x392bfa._0x513019));_0x3d5958['value']=_0x332c2e,_0x3d5958[_0x50bd1a(0x93)](new Event(_0x50bd1a(0x8f),{'bubbles':!![]}));const _0x32dde2=await _0x137bab('div.action-buttons\x20button[type=\x22submit\x22]');if(_0x32dde2[_0x50bd1a(0xab)])await _0x1e39a6(0xc8);!_0x32dde2['disabled']?_0x32dde2[_0x50bd1a(_0x392bfa._0x4e3e31)]():console['warn'](_0x50bd1a(0xb8));}catch(_0x3c41bd){console[_0x50bd1a(0x7d)]('[IVP]\x20執行出錯:',_0x3c41bd);}}window['addEventListener'](_0x24a9b3(0x9a),async function(_0x109805){const _0x2c5105=_0x24a9b3;if(_0x109805[_0x2c5105(_0x5bc689._0x36e23a)]!==_0x2d169e)return;const _0x1e8682=_0x109805[_0x2c5105(_0x5bc689._0x31966c)];if(_0x1e8682?.[_0x2c5105(_0x5bc689._0xf5a34b)]==='CEC_SEARCH_REQUEST'&&_0x1e8682[_0x2c5105(_0x5bc689._0x206d25)]){const {trackingNumber:_0x565483,timestamp:_0x9d2815}=_0x1e8682[_0x2c5105(0x82)];if(_0x9d2815>_0x2813a8){const _0x5745c3=_0x5d1144(_0x565483);if(_0x5745c3)console[_0x2c5105(_0x5bc689._0x4527f4)]('[Receiver]\x20頁面已顯示號碼\x20'+_0x565483+'，跳過查詢。');else{if(_0x38935e)await _0x3508f1(_0x565483);else _0x38518a&&await _0x407217(_0x565483);}_0x2813a8=_0x9d2815,_0x109805['source']&&_0x109805[_0x2c5105(0xa1)][_0x2c5105(0x86)]({'type':_0x2c5105(_0x5bc689._0x131c97),'payload':{'timestamp':_0x9d2815}},_0x109805[_0x2c5105(0xa8)]);}}},![]),_0xab2bc4();}()));function _0x506d(_0x4b3bdf,_0x445fe1){const _0x52e26d=_0x52e2();return _0x506d=function(_0x506d04,_0xe1983b){_0x506d04=_0x506d04-0x77;let _0x3deaef=_0x52e26d[_0x506d04];if(_0x506d['IrXqvf']===undefined){var _0x4e912b=function(_0x51cbfd){const _0x38935e='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x38518a='',_0x2d169e='';for(let _0x2813a8=0x0,_0x1e39a6,_0x137bab,_0xab2bc4=0x0;_0x137bab=_0x51cbfd['charAt'](_0xab2bc4++);~_0x137bab&&(_0x1e39a6=_0x2813a8%0x4?_0x1e39a6*0x40+_0x137bab:_0x137bab,_0x2813a8++%0x4)?_0x38518a+=String['fromCharCode'](0xff&_0x1e39a6>>(-0x2*_0x2813a8&0x6)):0x0){_0x137bab=_0x38935e['indexOf'](_0x137bab);}for(let _0x5d1144=0x0,_0x407217=_0x38518a['length'];_0x5d1144<_0x407217;_0x5d1144++){_0x2d169e+='%'+('00'+_0x38518a['charCodeAt'](_0x5d1144)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x2d169e);};_0x506d['MEXcGH']=_0x4e912b,_0x4b3bdf=arguments,_0x506d['IrXqvf']=!![];}const _0x34c033=_0x52e26d[0x0],_0x124c38=_0x506d04+_0x34c033,_0x44c608=_0x4b3bdf[_0x124c38];return!_0x44c608?(_0x3deaef=_0x506d['MEXcGH'](_0x3deaef),_0x4b3bdf[_0x124c38]=_0x3deaef):_0x3deaef=_0x44c608,_0x3deaef;},_0x506d(_0x4b3bdf,_0x445fe1);}function _0x52e2(){const _0x24a471=['AxzWlMLUC2LKzs51ChmUy29T','DhLWzq','z2v0rwXLBwvUDej5swq','zxjYB3i','B2jZzxj2zq','B25TzxnZywDL','mty5mZK2otjkvMTkwhm','w0Lwuf0G5z+36kgm5P+L6kMIoIa','Cgf5Bg9Hza','w1vUAxzLCNnHBcbszwnLAxzLCIbwmtrDiowvN+wlLEAwVdOG','mta4mZq4nhj6seDXwq','nJCXnZK2zK1QveXN','Cg9ZDe1LC3nHz2u','i21HAw5dB250ywLUzxiGpIbHChaTDhjHy2TPBMCGpIbKAxyGpIbKAxyGpIbKAxyUy29UDgfPBMvYlwzSDwLKlMqTBM9Uzq','q0vdx1jfuvvfu1rFuKvdruLwruq','Dgv4DenVBNrLBNq','Aw5JBhvKzxm','odbyzg9hq0u','w1vquYbxzwjDiowFT+IHJowhUUMmRZO','Bg9N','lcaJ','Aw5WDxq','svzqie1Vzgu','zgL2lMfJDgLVBI1IDxr0B25Zigj1DhrVBLTHCMLHlwXHyMvSpsjdBgvHCIjD','vhjHy2SGqwDHAw4GkfrVCcK','zgLZCgf0y2HfDMvUDa','zgLZy29UBMvJDa','zM9JDxm','yxbWBgLJyxrPB24VAMf2yxnJCMLWDa','cIaGicaGicaGicaGicaGicbZzxrjBNrLCNzHBcGOksa9pIb7cIaGicaGicaGicaGicaGicaGicaGC2vSzI5WB3n0twvZC2fNzsGNDgLJAYCPoWOGicaGicaGicaGicaGicaGFsWGnJaWmdaPoWOGicaGicaGicaGica','Dg9mB3DLCKnHC2u','iIdOTOxMMyi','BwvZC2fNzq','ndm2nda2ofv4BK5LCW','ndK3yvjxtxvj','C3rbChbFDhjHy2Tbz2fPBL90CMfJA2LUz051BuvUDhj5','vvbtifDLyIbnB2rL','yM9KEq','CxvLCNLtzwXLy3rVCKfSBa','C291CMnL','C3rbChbFyNrUvhjHy2S','zgf0yq','yMX1CG','Aw5WDxrjza','y2XPy2S','mtm0ndKXmJbpBwLHENG','B3jPz2LU','Ag9ZDg5HBwu','mtG2mda4shj4DgHb','zgLZywjSzwq','w0TLzxbbBgL2zv0G5zwF5yUv5AsX5PwxoG','m0fgtwj2uG','DhjPBq','Aw5WDxrBAwq9iKvUDgvYifrYywnRAw5Nie51BwjLCIjD','twfPBIbuCMfJAYaOq2vUDgvYkq','zgL2lMnKAY1VDMvYBgf5lxbHBMuGBgK6AgfZkgvTlMzHlxrPBwvZkq','yNrUswq','C3rbChbFDhjHy2TPBMDoDw1Izxi','DMfSDwu','Bg9JyxrPB24','y3jLyxrLt2jQzwn0vvjm','C3rbChbFDhjHy2Tbz2fPBL9NzxruCMfJAW','w0Lwuf0G5O+q5lQK5OYj6yIv5lUn6jMv5PA856Ab55sO54Ua5Owl44cc','mtKWmZq5m1zrBuDdCa','CxvLCNLtzwXLy3rVCG','w1vquYbxzwjDioACQUAjVUwiSos7U+s9LEwpR+EuQoEAHoI8UowfPEAHHUoaGG'];_0x52e2=function(){return _0x24a471;};return _0x52e2();}