// ==UserScript==
// @name         通用接收器
// @namespace    Universal Receiver
// @version      V15
// @description  同時支持 IVP 內部系統與 UPS 官網的自動查詢接收器。後臺保活功能。
// @author       Jerry Law
// @match        https://ivp.inside.ups.com/internal-visibility-portal*
// @match        https://www.ups.com/track*
// @grant        none
// @run-at       document-idle
// @updateURL    https://github.com/Jerry199022/Work-Release/raw/refs/heads/main/IVPReceiver.user.js
// @downloadURL  https://github.com/Jerry199022/Work-Release/raw/refs/heads/main/IVPReceiver.user.js
// ==/UserScript==

function _0x785a(_0x494187,_0x299c06){const _0xa3a39c=_0xa3a3();return _0x785a=function(_0x785a31,_0x11057e){_0x785a31=_0x785a31-0x14f;let _0x398e1d=_0xa3a39c[_0x785a31];if(_0x785a['zWDEbS']===undefined){var _0x314494=function(_0x10fa32){const _0xa0d519='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x1b19c8='',_0x5a1de7='';for(let _0x4cb8b6=0x0,_0x4dacf0,_0x4f690b,_0x218e64=0x0;_0x4f690b=_0x10fa32['charAt'](_0x218e64++);~_0x4f690b&&(_0x4dacf0=_0x4cb8b6%0x4?_0x4dacf0*0x40+_0x4f690b:_0x4f690b,_0x4cb8b6++%0x4)?_0x1b19c8+=String['fromCharCode'](0xff&_0x4dacf0>>(-0x2*_0x4cb8b6&0x6)):0x0){_0x4f690b=_0xa0d519['indexOf'](_0x4f690b);}for(let _0x11d4ed=0x0,_0x3c96a0=_0x1b19c8['length'];_0x11d4ed<_0x3c96a0;_0x11d4ed++){_0x5a1de7+='%'+('00'+_0x1b19c8['charCodeAt'](_0x11d4ed)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x5a1de7);};_0x785a['niYhnR']=_0x314494,_0x494187=arguments,_0x785a['zWDEbS']=!![];}const _0x19ad91=_0xa3a39c[0x0],_0x448a8a=_0x785a31+_0x19ad91,_0x6cfc06=_0x494187[_0x448a8a];return!_0x6cfc06?(_0x398e1d=_0x785a['niYhnR'](_0x398e1d),_0x494187[_0x448a8a]=_0x398e1d):_0x398e1d=_0x6cfc06,_0x398e1d;},_0x785a(_0x494187,_0x299c06);}function _0xa3a3(){const _0x4f9251=['C3rbChbFyNrUvhjHy2S','w1vquYbxzwjDiowFT+IHJowhUUMmRZO','y2HHBMDL','Ahr0Chm6lY91ChnKCML2zs5SAwDODg5PBMCUzM9Yy2uUy29T','Aw5JBhvKzxm','yM9KEq','m2DsBwnOBa','w0Lwuf0G5z+36kgm5P+L6kMIoIa','CxvLCNLtzwXLy3rVCKfSBa','w1vquYbxzwjDioAQOUA4RowiSow9IoEQL+MxNoMwIEAmIEMiLE+8JoATO+wCQoM7NUAtII4UlG','DhLWzq','yxbWBgLJyxrPB24VAMf2yxnJCMLWDa','vhjHy2SGqwDHAw4GkfrVCcK','zxjYB3i','mZu1mti4A2HxEuXf','Bg9JyxrPB24','mtG5qxHRChzn','nduXndy0mgjsrKntDW','zMLUza','zgL2lMfJDgLVBI1IDxr0B25Zigj1DhrVBLT0ExbLpsjZDwjTAxqIxq','mtiXmZCWntHlEgP1rNq','yMX1CG','zgL2lMnKAY1VDMvYBgf5lxbHBMuGBgK6AgfZkgvTlMzHlxrPBwvZkq','DxbZlMnVBq','DhjPBq','C291CMnL','Aw5WDxq','AxzWlMLUC2LKzs51ChmUy29T','562j5B6f5ywd57sGici','Cgf5Bg9Hza','B25TzxnZywDL','w0Lwuf0G5z+36kgm5yE66yYVoG','y3jLyxrLt2jQzwn0vvjm','zgLZywjSzwq','zM9JDxm','AdyUAdz0CMfJA2LUzYbZCgfU','Cg9ZDe1LC3nHz2u','z2v0rwXLBwvUDej5swq','mJmYD3nVu3rU','nJzysuXRr28','i21HAw5dB250ywLUzxiGpIbHChaTDhjHy2TPBMCGpIbKAxyGpIbKAxyGpIbKAxyUy29UDgfPBMvYlwzSDwLKlMqTBM9Uzq','Aw5WDxrjza','w1vUAxzLCNnHBcbszwnLAxzLCIbwmtrDiowvN+wlLEAwVdOG','CMvWBgfJzq','zgLZCgf0y2HfDMvUDa','D2fYBG','ntu0ogL6r2DitG','BwvZC2fNzq','vvbtifDLyIbnB2rL','w0TLzxbbBgL2zv0G5zwF5yUv5AsX5PwxoG','Ag9ZDg5HBwu','cIaGicaGicaGicaGicaGicbZzxrjBNrLCNzHBcGOksa9pIb7cIaGicaGicaGicaGicaGicaGicaGC2vSzI5WB3n0twvZC2fNzsGNDgLJAYCPoWOGicaGicaGicaGicaGicaGFsWGnJaWmdaPoWOGicaGicaGicaGica','zgL2lMfJDgLVBI1IDxr0B25Zigj1DhrVBLTHCMLHlwXHyMvSpsjdBgvHCIjD','zgLZy29UBMvJDa','yNv0Dg9UlMnSB3nLw2rHDgeTzgLZBwLZCZ0IBw9KywWIxq','yNrUswq','Bg9N','Dg9mB3DLCKnHC2u','mJy5otCXnLrcvwTNBG','DMfSDwu','mtmWotCWCKL4B05c','CxvLCNLtzwXLy3rVCG','y2XPy2S','C3rbChbFDhjHy2Tbz2fPBL90CMfJA2LUz051BuvUDhj5','B3jPz2LU','w1vquYbxzwjDioACQUAjVUwiSos7U+s9LEwpR+EuQoEAHoI8UowfPEAHHUoaGG','lcaJ','nZq5nta1txHTAffO','77Ym6lEZ6ygo5P+L6kMI44cc'];_0xa3a3=function(){return _0x4f9251;};return _0xa3a3();}(function(_0x2fd3c1,_0x54650b){const _0x307daf={_0xd483b:0x184,_0x40368a:0x15c,_0x2eee22:0x190,_0x41153e:0x164,_0x744dcb:0x166,_0x585aad:0x16a,_0x4f55ec:0x192,_0x4b24ba:0x17d},_0x4f7e69=_0x785a,_0x362704=_0x2fd3c1();while(!![]){try{const _0x5a1170=-parseInt(_0x4f7e69(0x17c))/0x1*(parseInt(_0x4f7e69(_0x307daf._0xd483b))/0x2)+-parseInt(_0x4f7e69(_0x307daf._0x40368a))/0x3*(parseInt(_0x4f7e69(_0x307daf._0x2eee22))/0x4)+-parseInt(_0x4f7e69(0x154))/0x5+parseInt(_0x4f7e69(_0x307daf._0x41153e))/0x6*(parseInt(_0x4f7e69(_0x307daf._0x744dcb))/0x7)+-parseInt(_0x4f7e69(0x167))/0x8+parseInt(_0x4f7e69(_0x307daf._0x585aad))/0x9+parseInt(_0x4f7e69(_0x307daf._0x4f55ec))/0xa*(-parseInt(_0x4f7e69(_0x307daf._0x4b24ba))/0xb);if(_0x5a1170===_0x54650b)break;else _0x362704['push'](_0x362704['shift']());}catch(_0x1cd50b){_0x362704['push'](_0x362704['shift']());}}}(_0xa3a3,0xcbf00),(function(){'use strict';const _0x1df375={_0x4b0216:0x165,_0x280bbd:0x159,_0x2b079a:0x180},_0x897a49={_0x21da73:0x18e,_0x47beca:0x16f},_0x599eb4={_0x3b5679:0x18e,_0x2b13fa:0x15d,_0x43b396:0x17e,_0x5dae8e:0x14f,_0x650d3d:0x182,_0x5e7065:0x169},_0x23cc01={_0x18b80f:0x162,_0x13bfd5:0x150,_0x81229f:0x156,_0x3b9a94:0x18e,_0x54cceb:0x17b,_0x5cfd5c:0x17f,_0x56cb00:0x153,_0x38c4da:0x168,_0x47b590:0x178,_0x20eb38:0x158,_0x4ef37c:0x16b,_0x4187ef:0x15b},_0x2862a0={_0x2b0b22:0x179,_0x115024:0x18f},_0x20cdf8={_0x4a1dc6:0x189,_0x338ad0:0x161,_0x5c62a5:0x176,_0x1e78a5:0x174},_0x427ab7={_0x1d2df5:0x193},_0x595a8e=_0x785a;const _0x10fa32=window[_0x595a8e(_0x1df375._0x4b0216)][_0x595a8e(0x188)],_0xa0d519=_0x10fa32[_0x595a8e(0x15a)](_0x595a8e(0x171)),_0x1b19c8=_0x10fa32['includes'](_0x595a8e(0x16d)),_0x5a1de7=_0x595a8e(_0x1df375._0x280bbd);console[_0x595a8e(0x18e)](_0x595a8e(_0x1df375._0x2b079a)+_0x10fa32),console['log']('[Mode]\x20'+(_0xa0d519?'IVP\x20Mode':_0x1b19c8?_0x595a8e(0x186):'Unknown\x20Mode'));let _0x4cb8b6=0x0;const _0x4dacf0=_0x290ba6=>new Promise(_0x40cc90=>setTimeout(_0x40cc90,_0x290ba6));function _0x4f690b(_0x19ea89,_0x20db0e=document['body'],_0x7bb000=0x1388){const _0x281fe3={_0x20683b:0x172};return new Promise((_0x203f8b,_0x91b062)=>{const _0x557dbb={_0x255efc:0x193},_0x35bcfe=_0x785a,_0x22f1ae=_0x20db0e[_0x35bcfe(_0x427ab7._0x1d2df5)](_0x19ea89);if(_0x22f1ae)return _0x203f8b(_0x22f1ae);const _0x60053e=new MutationObserver(()=>{const _0x4ef154=_0x35bcfe,_0x5e1bd1=_0x20db0e[_0x4ef154(_0x557dbb._0x255efc)](_0x19ea89);_0x5e1bd1&&(_0x60053e['disconnect'](),_0x203f8b(_0x5e1bd1));});_0x60053e['observe'](_0x20db0e,{'childList':!![],'subtree':!![]}),setTimeout(()=>{const _0x4a3882=_0x35bcfe;_0x60053e[_0x4a3882(0x18b)](),_0x91b062(new Error(_0x4a3882(_0x281fe3._0x20683b)+_0x19ea89+'\x22\x20超時'));},_0x7bb000);});}function _0x218e64(){const _0x236389=_0x595a8e;try{const _0x35f7ec=new Blob([_0x236389(_0x20cdf8._0x4a1dc6)],{'type':_0x236389(_0x20cdf8._0x338ad0)}),_0x1d5b84=new Worker(URL[_0x236389(_0x20cdf8._0x5c62a5)](_0x35f7ec));_0x1d5b84[_0x236389(_0x20cdf8._0x1e78a5)]=()=>{},console['log']('[KeepAlive]\x20保活機制已啟動\x20-\x20頻率:\x201分鐘/次');}catch(_0x444389){console[_0x236389(0x163)](_0x236389(0x187),_0x444389);}}function _0x11d4ed(_0x520bb3){const _0x597fff=_0x595a8e;if(!_0x520bb3)return![];let _0x4bbe4c=null,_0x131542='';if(_0xa0d519)_0x4bbe4c=document['querySelector'](_0x597fff(_0x2862a0._0x2b0b22));else _0x1b19c8&&(_0x4bbe4c=document['getElementById']('stApp_trackingNumber'));if(_0x4bbe4c){_0x131542=_0x4bbe4c['textContent'][_0x597fff(0x16e)]();const _0x4f4fb1=_0x131542[_0x597fff(0x181)](/\s/g,''),_0xf7a420=_0x520bb3['replace'](/\s/g,'');if(_0x4f4fb1['toLowerCase']()===_0xf7a420[_0x597fff(_0x2862a0._0x115024)]())return!![];}return![];}async function _0x3c96a0(_0x38b384){const _0x4d8508=_0x595a8e;console['log']('[UPS\x20Web]\x20執行查詢:\x20'+_0x38b384);const _0x2118a1=[{'name':_0x4d8508(_0x23cc01._0x18b80f),'inputId':_0x4d8508(_0x23cc01._0x13bfd5),'btnId':'stApp_trackAgain_getTrack'},{'name':'Main\x20Track\x20(Center)','inputId':'stApp_trackingNumber','btnId':_0x4d8508(_0x23cc01._0x81229f)}];try{const _0xf3d798=document[_0x4d8508(0x193)](_0x4d8508(0x18c));_0xf3d798&&(console[_0x4d8508(_0x23cc01._0x3b9a94)](_0x4d8508(0x15f)),_0xf3d798['click'](),await _0x4dacf0(0x12c));let _0x33d22c=document['getElementById'](_0x2118a1[0x0]['inputId'])||document[_0x4d8508(_0x23cc01._0x54cceb)](_0x2118a1[0x1][_0x4d8508(0x17f)]);if(!_0x33d22c)try{const _0x11edb2='#'+_0x2118a1[0x0][_0x4d8508(_0x23cc01._0x5cfd5c)]+_0x4d8508(_0x23cc01._0x56cb00)+_0x2118a1[0x1]['inputId'];_0x33d22c=await _0x4f690b(_0x11edb2,document['body'],0xbb8);}catch(_0x24fc92){console['error'](_0x4d8508(0x152));return;}const _0x2cf5dd=_0x2118a1[_0x4d8508(_0x23cc01._0x38c4da)](_0x33a5bb=>_0x33a5bb[_0x4d8508(0x17f)]===_0x33d22c['id']);if(!_0x2cf5dd)return;_0x33d22c[_0x4d8508(_0x23cc01._0x47b590)](),_0x33d22c['value']='',_0x33d22c[_0x4d8508(0x191)]=_0x38b384,_0x33d22c[_0x4d8508(0x182)](new Event(_0x4d8508(0x170),{'bubbles':!![]})),_0x33d22c[_0x4d8508(0x182)](new Event(_0x4d8508(_0x23cc01._0x20eb38),{'bubbles':!![]})),_0x33d22c[_0x4d8508(0x182)](new Event(_0x4d8508(_0x23cc01._0x4ef37c),{'bubbles':!![]})),await _0x4dacf0(0xc8);let _0x2ba2df=document['getElementById'](_0x2cf5dd['btnId']);if(!_0x2ba2df)try{_0x2ba2df=await _0x4f690b('#'+_0x2cf5dd[_0x4d8508(0x18d)],document[_0x4d8508(_0x23cc01._0x4187ef)],0x7d0);}catch(_0x1b45f2){}if(_0x2ba2df){_0x2ba2df['click']();try{const _0x32c0ff=await _0x4f690b('#st_App_View_Details',document['body'],0x2710);_0x32c0ff&&(await _0x4dacf0(0x64),_0x32c0ff[_0x4d8508(0x14f)]());}catch(_0x5c1877){}}}catch(_0xd9c3ba){console[_0x4d8508(0x163)](_0x4d8508(0x157),_0xd9c3ba);}}async function _0x4234cb(_0xea4db8){const _0x3f6cc1=_0x595a8e;console[_0x3f6cc1(_0x599eb4._0x3b5679)](_0x3f6cc1(_0x599eb4._0x2b13fa)+_0xea4db8);const _0xbe65=document[_0x3f6cc1(0x15e)](_0x3f6cc1(0x16c));for(const _0x508557 of _0xbe65){_0x508557['click'](),await _0x4dacf0(0x64);}try{const _0x3886a2=document['querySelector'](_0x3f6cc1(_0x599eb4._0x43b396));if(_0x3886a2){const _0x1d200c=document[_0x3f6cc1(0x193)]('#toggle-visibility\x20>\x20button');if(_0x1d200c)_0x1d200c[_0x3f6cc1(_0x599eb4._0x5dae8e)]();await _0x4dacf0(0xc8);}const _0x53e7c6=document[_0x3f6cc1(0x193)](_0x3f6cc1(0x18a));_0x53e7c6&&(_0x53e7c6[_0x3f6cc1(0x14f)](),await _0x4dacf0(0xc8));const _0x3fb9b2=await _0x4f690b('input[id=\x22Enter\x20Tracking\x20Number\x22]');_0x3fb9b2[_0x3f6cc1(0x191)]=_0xea4db8,_0x3fb9b2[_0x3f6cc1(_0x599eb4._0x650d3d)](new Event('input',{'bubbles':!![]}));const _0x280d5d=await _0x4f690b(_0x3f6cc1(_0x599eb4._0x5e7065));if(_0x280d5d[_0x3f6cc1(0x177)])await _0x4dacf0(0xc8);!_0x280d5d['disabled']?_0x280d5d[_0x3f6cc1(_0x599eb4._0x5dae8e)]():console[_0x3f6cc1(0x183)]('[IVP]\x20提交按鈕仍處於禁用狀態。');}catch(_0xd7cd0a){console['error'](_0x3f6cc1(0x175),_0xd7cd0a);}}window['addEventListener'](_0x595a8e(0x185),async function(_0x22e920){const _0x40d64d=_0x595a8e;if(_0x22e920['origin']!==_0x5a1de7)return;const _0x44eee0=_0x22e920['data'];if(_0x44eee0?.[_0x40d64d(0x160)]==='CEC_SEARCH_REQUEST'&&_0x44eee0[_0x40d64d(0x173)]){const {trackingNumber:_0x1ffddd,timestamp:_0x3b33e9}=_0x44eee0['payload'];if(_0x3b33e9>_0x4cb8b6){const _0x3b3566=_0x11d4ed(_0x1ffddd);if(_0x3b3566)console[_0x40d64d(_0x897a49._0x21da73)]('[Receiver]\x20頁面已顯示號碼\x20'+_0x1ffddd+_0x40d64d(0x155));else{if(_0xa0d519)await _0x4234cb(_0x1ffddd);else _0x1b19c8&&await _0x3c96a0(_0x1ffddd);}_0x4cb8b6=_0x3b33e9,_0x22e920[_0x40d64d(_0x897a49._0x47beca)]&&_0x22e920['source'][_0x40d64d(0x17a)]({'type':'CEC_REQUEST_RECEIVED','payload':{'timestamp':_0x3b33e9}},_0x22e920[_0x40d64d(0x151)]);}}},![]),_0x218e64();}()));