// ==UserScript==
// @name         通用接收器
// @namespace    Universal Receiver
// @version      V14
// @description  同時支持 IVP 內部系統與 UPS 官網的自動查詢接收器。後臺保活功能。
// @author       Jerry Law
// @match        https://ivp.inside.ups.com/internal-visibility-portal*
// @match        https://www.ups.com/track*
// @grant        none
// @run-at       document-idle
// @updateURL    https://raw.githubusercontent.com/Jerry199022/Work/refs/heads/main/IVPReceiver.js
// @downloadURL  https://raw.githubusercontent.com/Jerry199022/Work/refs/heads/main/IVPReceiver.js
// ==/UserScript==

function _0x5e71(_0x39220b,_0x48775f){const _0x5a1234=_0x5a12();return _0x5e71=function(_0x5e7120,_0x5976f7){_0x5e7120=_0x5e7120-0x12e;let _0x57af73=_0x5a1234[_0x5e7120];if(_0x5e71['xjdgWn']===undefined){var _0x2e3734=function(_0x15f9dd){const _0x28f192='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x505f8d='',_0x1379b5='';for(let _0x25642d=0x0,_0x29e1a3,_0x3f4aa1,_0x45f419=0x0;_0x3f4aa1=_0x15f9dd['charAt'](_0x45f419++);~_0x3f4aa1&&(_0x29e1a3=_0x25642d%0x4?_0x29e1a3*0x40+_0x3f4aa1:_0x3f4aa1,_0x25642d++%0x4)?_0x505f8d+=String['fromCharCode'](0xff&_0x29e1a3>>(-0x2*_0x25642d&0x6)):0x0){_0x3f4aa1=_0x28f192['indexOf'](_0x3f4aa1);}for(let _0x4a9960=0x0,_0x4febba=_0x505f8d['length'];_0x4a9960<_0x4febba;_0x4a9960++){_0x1379b5+='%'+('00'+_0x505f8d['charCodeAt'](_0x4a9960)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x1379b5);};_0x5e71['pkRYha']=_0x2e3734,_0x39220b=arguments,_0x5e71['xjdgWn']=!![];}const _0x1ee4f7=_0x5a1234[0x0],_0x209c98=_0x5e7120+_0x1ee4f7,_0x54a742=_0x39220b[_0x209c98];return!_0x54a742?(_0x57af73=_0x5e71['pkRYha'](_0x57af73),_0x39220b[_0x209c98]=_0x57af73):_0x57af73=_0x54a742,_0x57af73;},_0x5e71(_0x39220b,_0x48775f);}(function(_0xf432e8,_0x339084){const _0x3eecc2={_0x2cd60b:0x130,_0x4eb832:0x166,_0x5f0b44:0x13b,_0x1743cc:0x16d,_0x428e1a:0x151,_0x54a537:0x136,_0x3e16fb:0x140,_0x112596:0x132},_0x59e688=_0x5e71,_0x1c82d5=_0xf432e8();while(!![]){try{const _0x2513a8=-parseInt(_0x59e688(_0x3eecc2._0x2cd60b))/0x1*(parseInt(_0x59e688(0x162))/0x2)+-parseInt(_0x59e688(0x150))/0x3*(parseInt(_0x59e688(_0x3eecc2._0x4eb832))/0x4)+-parseInt(_0x59e688(_0x3eecc2._0x5f0b44))/0x5+parseInt(_0x59e688(0x16f))/0x6+-parseInt(_0x59e688(_0x3eecc2._0x1743cc))/0x7*(-parseInt(_0x59e688(_0x3eecc2._0x428e1a))/0x8)+parseInt(_0x59e688(_0x3eecc2._0x54a537))/0x9*(parseInt(_0x59e688(_0x3eecc2._0x3e16fb))/0xa)+parseInt(_0x59e688(_0x3eecc2._0x112596))/0xb;if(_0x2513a8===_0x339084)break;else _0x1c82d5['push'](_0x1c82d5['shift']());}catch(_0xe575a4){_0x1c82d5['push'](_0x1c82d5['shift']());}}}(_0x5a12,0xdac6c),(function(){'use strict';const _0x55700d={_0x136357:0x15b,_0x499763:0x131,_0x5b7582:0x172,_0x3d5ee0:0x165,_0x4964e1:0x14a,_0x46d514:0x15c},_0x688977={_0x4bc1a1:0x157,_0x140be8:0x160,_0x574d0d:0x160,_0x477a45:0x154},_0x5cc1cb={_0x16679e:0x158,_0x4474a4:0x137,_0x25ba20:0x15d,_0x192f4a:0x155,_0x1e8742:0x168,_0xae8249:0x12f,_0x5f09de:0x141,_0x5e9494:0x142,_0x1704d0:0x148,_0x318c26:0x167,_0x2e0456:0x171},_0x51b495={_0x521ee7:0x165,_0x16228d:0x15e,_0xa494bc:0x16e,_0x57d451:0x174,_0x25a2b5:0x16c,_0x57739e:0x174,_0x57bf62:0x14d,_0xa8c87e:0x171,_0x37f971:0x16a,_0xc0a887:0x147,_0x12833b:0x163,_0x1fd248:0x142,_0x1db443:0x13c,_0x3b4a3a:0x145,_0x17ec65:0x155,_0xe30171:0x171,_0x2e24a1:0x173},_0x463a6c={_0x273366:0x133,_0xce1ff8:0x138,_0x407f48:0x13e},_0x227f72=_0x5e71;const _0x15f9dd=window[_0x227f72(0x146)][_0x227f72(0x143)],_0x28f192=_0x15f9dd[_0x227f72(_0x55700d._0x136357)](_0x227f72(0x14f)),_0x505f8d=_0x15f9dd[_0x227f72(_0x55700d._0x136357)](_0x227f72(_0x55700d._0x499763)),_0x1379b5=_0x227f72(_0x55700d._0x5b7582);console[_0x227f72(_0x55700d._0x3d5ee0)](_0x227f72(_0x55700d._0x4964e1)+_0x15f9dd),console[_0x227f72(0x165)](_0x227f72(0x135)+(_0x28f192?'IVP\x20Mode':_0x505f8d?_0x227f72(0x13d):_0x227f72(_0x55700d._0x46d514)));let _0x25642d=0x0;const _0x29e1a3=_0x1faf83=>new Promise(_0x3f7da3=>setTimeout(_0x3f7da3,_0x1faf83));function _0x3f4aa1(_0x4e6d80,_0x3217d2=document[_0x227f72(0x14d)],_0x33ae55=0x1388){const _0x4b6231={_0x461e43:0x156};return new Promise((_0x9e596d,_0x232ac7)=>{const _0xb20e79=_0x3217d2['querySelector'](_0x4e6d80);if(_0xb20e79)return _0x9e596d(_0xb20e79);const _0x4a0245=new MutationObserver(()=>{const _0x566997=_0x5e71,_0x26168e=_0x3217d2[_0x566997(0x168)](_0x4e6d80);_0x26168e&&(_0x4a0245[_0x566997(_0x4b6231._0x461e43)](),_0x9e596d(_0x26168e));});_0x4a0245['observe'](_0x3217d2,{'childList':!![],'subtree':!![]}),setTimeout(()=>{const _0x386d83=_0x5e71;_0x4a0245['disconnect'](),_0x232ac7(new Error('等待元素\x20\x22'+_0x4e6d80+_0x386d83(0x14e)));},_0x33ae55);});}function _0x45f419(){const _0x1b4456=_0x227f72;try{const _0xbfcdda=new Blob([_0x1b4456(_0x463a6c._0x273366)],{'type':_0x1b4456(0x149)}),_0x284309=new Worker(URL[_0x1b4456(_0x463a6c._0xce1ff8)](_0xbfcdda));_0x284309[_0x1b4456(_0x463a6c._0x407f48)]=()=>{},console[_0x1b4456(0x165)]('[KeepAlive]\x20保活機制已啟動\x20-\x20頻率:\x201分鐘/次');}catch(_0x1d88e2){console[_0x1b4456(0x171)](_0x1b4456(0x16b),_0x1d88e2);}}function _0x4a9960(_0x1b4762){const _0x114d83=_0x227f72;if(!_0x1b4762)return![];let _0x1e8f91=null,_0x27d96c='';if(_0x28f192)_0x1e8f91=document[_0x114d83(0x168)]('h6.h6tracking\x20span');else _0x505f8d&&(_0x1e8f91=document[_0x114d83(0x16e)]('stApp_trackingNumber'));if(_0x1e8f91){_0x27d96c=_0x1e8f91['textContent'][_0x114d83(0x152)]();const _0x244c39=_0x27d96c[_0x114d83(0x164)](/\s/g,''),_0x130542=_0x1b4762['replace'](/\s/g,'');if(_0x244c39[_0x114d83(0x169)]()===_0x130542[_0x114d83(0x169)]())return!![];}return![];}async function _0x4febba(_0x593d83){const _0x4d866a=_0x227f72;console[_0x4d866a(_0x51b495._0x521ee7)]('[UPS\x20Web]\x20執行查詢:\x20'+_0x593d83);const _0x1339d9=[{'name':'Track\x20Again\x20(Top)','inputId':_0x4d866a(0x144),'btnId':'stApp_trackAgain_getTrack'},{'name':'Main\x20Track\x20(Center)','inputId':_0x4d866a(0x170),'btnId':_0x4d866a(_0x51b495._0x16228d)}];try{const _0x370989=document['querySelector'](_0x4d866a(0x161));_0x370989&&(console[_0x4d866a(0x165)]('[UPS\x20Web]\x20檢測到彈窗關閉按鈕，正在點擊...'),_0x370989['click'](),await _0x29e1a3(0x12c));let _0x39e799=document[_0x4d866a(_0x51b495._0xa494bc)](_0x1339d9[0x0][_0x4d866a(0x174)])||document[_0x4d866a(_0x51b495._0xa494bc)](_0x1339d9[0x1][_0x4d866a(_0x51b495._0x57d451)]);if(!_0x39e799)try{const _0x9720bd='#'+_0x1339d9[0x0]['inputId']+_0x4d866a(_0x51b495._0x25a2b5)+_0x1339d9[0x1][_0x4d866a(_0x51b495._0x57739e)];_0x39e799=await _0x3f4aa1(_0x9720bd,document[_0x4d866a(_0x51b495._0x57bf62)],0xbb8);}catch(_0x36ae58){console[_0x4d866a(_0x51b495._0xa8c87e)](_0x4d866a(_0x51b495._0x37f971));return;}const _0x5aff30=_0x1339d9[_0x4d866a(_0x51b495._0xc0a887)](_0xd6a372=>_0xd6a372['inputId']===_0x39e799['id']);if(!_0x5aff30)return;_0x39e799[_0x4d866a(0x14c)](),_0x39e799[_0x4d866a(_0x51b495._0x12833b)]='',_0x39e799[_0x4d866a(0x163)]=_0x593d83,_0x39e799[_0x4d866a(_0x51b495._0x1fd248)](new Event(_0x4d866a(0x14b),{'bubbles':!![]})),_0x39e799['dispatchEvent'](new Event(_0x4d866a(_0x51b495._0x1db443),{'bubbles':!![]})),_0x39e799[_0x4d866a(0x142)](new Event('blur',{'bubbles':!![]})),await _0x29e1a3(0xc8);let _0x1c29ae=document['getElementById'](_0x5aff30[_0x4d866a(_0x51b495._0x3b4a3a)]);if(!_0x1c29ae)try{_0x1c29ae=await _0x3f4aa1('#'+_0x5aff30['btnId'],document[_0x4d866a(0x14d)],0x7d0);}catch(_0x563bcc){}if(_0x1c29ae){_0x1c29ae[_0x4d866a(_0x51b495._0x17ec65)]();try{const _0x3b6a2d=await _0x3f4aa1(_0x4d866a(0x12e),document[_0x4d866a(_0x51b495._0x57bf62)],0x2710);_0x3b6a2d&&(await _0x29e1a3(0x64),_0x3b6a2d[_0x4d866a(0x155)]());}catch(_0x18b61c){}}}catch(_0x38dc73){console[_0x4d866a(_0x51b495._0xe30171)](_0x4d866a(_0x51b495._0x2e24a1),_0x38dc73);}}async function _0x35bdce(_0x416d70){const _0x320bbd=_0x227f72;console[_0x320bbd(0x165)](_0x320bbd(_0x5cc1cb._0x16679e)+_0x416d70);const _0x117719=document['querySelectorAll'](_0x320bbd(_0x5cc1cb._0x4474a4));for(const _0x37a5e5 of _0x117719){_0x37a5e5[_0x320bbd(0x155)](),await _0x29e1a3(0x64);}try{const _0x298c68=document[_0x320bbd(0x168)](_0x320bbd(_0x5cc1cb._0x25ba20));if(_0x298c68){const _0x5bf09d=document['querySelector'](_0x320bbd(0x13f));if(_0x5bf09d)_0x5bf09d[_0x320bbd(_0x5cc1cb._0x192f4a)]();await _0x29e1a3(0xc8);}const _0x17bb01=document[_0x320bbd(_0x5cc1cb._0x1e8742)](_0x320bbd(_0x5cc1cb._0xae8249));_0x17bb01&&(_0x17bb01[_0x320bbd(0x155)](),await _0x29e1a3(0xc8));const _0x2365bd=await _0x3f4aa1(_0x320bbd(_0x5cc1cb._0x5f09de));_0x2365bd[_0x320bbd(0x163)]=_0x416d70,_0x2365bd[_0x320bbd(_0x5cc1cb._0x5e9494)](new Event(_0x320bbd(0x14b),{'bubbles':!![]}));const _0x2bc54c=await _0x3f4aa1(_0x320bbd(0x139));if(_0x2bc54c[_0x320bbd(_0x5cc1cb._0x1704d0)])await _0x29e1a3(0xc8);!_0x2bc54c[_0x320bbd(0x148)]?_0x2bc54c['click']():console[_0x320bbd(0x15a)](_0x320bbd(_0x5cc1cb._0x318c26));}catch(_0x34a3cc){console[_0x320bbd(_0x5cc1cb._0x2e0456)](_0x320bbd(0x153),_0x34a3cc);}}window[_0x227f72(0x159)](_0x227f72(0x15f),async function(_0x4f11bd){const _0x5315fe=_0x227f72;if(_0x4f11bd['origin']!==_0x1379b5)return;const _0x271d13=_0x4f11bd['data'];if(_0x271d13?.[_0x5315fe(0x13a)]===_0x5315fe(_0x688977._0x4bc1a1)&&_0x271d13[_0x5315fe(_0x688977._0x140be8)]){const {trackingNumber:_0xc03b8b,timestamp:_0x2b3eba}=_0x271d13[_0x5315fe(_0x688977._0x574d0d)];if(_0x2b3eba>_0x25642d){const _0x4c1461=_0x4a9960(_0xc03b8b);if(_0x4c1461)console['log']('[Receiver]\x20頁面已顯示號碼\x20'+_0xc03b8b+'，跳過查詢。');else{if(_0x28f192)await _0x35bdce(_0xc03b8b);else _0x505f8d&&await _0x4febba(_0xc03b8b);}_0x25642d=_0x2b3eba,_0x4f11bd['source']&&_0x4f11bd['source']['postMessage']({'type':_0x5315fe(_0x688977._0x477a45),'payload':{'timestamp':_0x2b3eba}},_0x4f11bd[_0x5315fe(0x134)]);}}},![]),_0x45f419();}()));function _0x5a12(){const _0x29e9cc=['yNv0Dg9UlMnSB3nLw2rHDgeTzgLZBwLZCZ0IBw9KywWIxq','mtrlzu1cr0i','DMfSDwu','CMvWBgfJzq','Bg9N','mZi1nta3nLf3yNj1CG','w0Lwuf0G5O+q5lQK5OYj6yIv5lUn6jMv5PA856Ab55sO54Ua5Owl44cc','CxvLCNLtzwXLy3rVCG','Dg9mB3DLCKnHC2u','w1vquYbxzwjDioACQUAjVUwiSos7U+s9LEwpR+EuQoEAHoI8UowfPEAHHUoaGG','w0TLzxbbBgL2zv0G5zwF5yUv5AsX5PwxoG','lcaJ','mZKYEvjXteLM','z2v0rwXLBwvUDej5swq','odyXmduXmgjWvLL5CW','C3rbChbFDhjHy2TPBMDoDw1Izxi','zxjYB3i','Ahr0Chm6lY91ChnKCML2zs5SAwDODg5PBMCUzM9Yy2uUy29T','w1vquYbxzwjDiowFT+IHJowhUUMmRZO','Aw5WDxrjza','i3n0x0fWCf9wAwv3x0rLDgfPBhm','zgL2lMfJDgLVBI1IDxr0B25Zigj1DhrVBLTHCMLHlwXHyMvSpsjdBgvHCIjD','nZC4nJfbEgfPzhO','DxbZlMnVBq','mJC5mZy4mwPlrxn0yG','cIaGicaGicaGicaGicaGicbZzxrjBNrLCNzHBcGOksa9pIb7cIaGicaGicaGicaGicaGicaGicaGC2vSzI5WB3n0twvZC2fNzsGNDgLJAYCPoWOGicaGicaGicaGicaGicaGFsWGnJaWmdaPoWOGicaGicaGicaGica','B3jPz2LU','w01VzgvDia','own6qMHsAW','zgL2lMnKAY1VDMvYBgf5lxbHBMuGBgK6AgfZkgvTlMzHlxrPBwvZkq','y3jLyxrLt2jQzwn0vvjm','zgL2lMfJDgLVBI1IDxr0B25Zigj1DhrVBLT0ExbLpsjZDwjTAxqIxq','DhLWzq','ndqXmty5mfHRwhHJqW','y2HHBMDL','vvbtifDLyIbnB2rL','B25TzxnZywDL','i3rVz2DSzs12AxnPyMLSAxr5id4GyNv0Dg9U','mta2ntaXmtbhCfLKzfa','Aw5WDxrBAwq9iKvUDgvYifrYywnRAw5Nie51BwjLCIjD','zgLZCgf0y2HfDMvUDa','Ag9ZDg5HBwu','C3rbChbFDhjHy2Tbz2fPBL90CMfJA2LUz051BuvUDhj5','yNrUswq','Bg9JyxrPB24','zMLUza','zgLZywjSzwq','yxbWBgLJyxrPB24VAMf2yxnJCMLWDa','w1vUAxzLCNnHBcbszwnLAxzLCIbwmtrDiowvN+wlLEAwVdOG','Aw5WDxq','zM9JDxm','yM9KEq','iIdOTOxMMyi','AxzWlMLUC2LKzs51ChmUy29T','nLPdrwnSzW','mtCWotKYt3jLwNzc','DhjPBq','w0Lwuf0G5z+36kgm5yE66yYVoG','q0vdx1jfuvvfu1rFuKvdruLwruq','y2XPy2S','zgLZy29UBMvJDa','q0vdx1nfqvjdsf9srvfvrvnu','w0Lwuf0G5z+36kgm5P+L6kMIoIa','ywrKrxzLBNrmAxn0zw5LCG','D2fYBG','Aw5JBhvKzxm','vw5RBM93BIbnB2rL','i21HAw5dB250ywLUzxiGpIbHChaTDhjHy2TPBMCGpIbKAxyGpIbKAxyGpIbKAxyUy29UDgfPBMvYlwzSDwLKlMqTBM9Uzq','C3rbChbFyNrUvhjHy2S','BwvZC2fNzq','Cgf5Bg9Hza'];_0x5a12=function(){return _0x29e9cc;};return _0x5a12();}